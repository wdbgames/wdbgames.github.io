<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WDBG</title>
    <link rel="stylesheet" href="scripts/style.css">
    <script src="scripts/main.js" defer></script>
  </head>
  <body>
    <div class="navbar">
      <a href="index.html">Home</a>
      <a href="games.html">Games</a>
      <a href="changelog.html">Changelog</a>
      <a href="settings.html">Settings</a>
    </div>
    <div id="tags-container"></div>
    <div id="game-container" class="games-container"></div>
    <script>
      let allGames = [];
      let selectedTags = new Set();
      const container = document.getElementById("game-container");
      async function loadGames() {
        try {
          const response = await fetch("scripts/json/games.json");
          allGames = await response.json();
          let allTags = [...new Set(allGames.flatMap(game => game.tags || []))];
          if (!allTags.includes("GN")) allTags.push("GN");
          allTags.sort((a, b) => {
            if (a === "Featured") return -1;
            if (b === "Featured") return 1;
            if (a === "Beta") return 1;
            if (b === "Beta") return -1;
            return a.localeCompare(b);
          });
          const tagsContainer = document.getElementById("tags-container");
          allTags.forEach(tag => {
            const btn = document.createElement("button");
            btn.textContent = tag;
            btn.className = "tag-button";
            btn.onclick = () => toggleTag(tag, btn);
            tagsContainer.appendChild(btn);
          });
          renderGames();
        } catch (error) {
          console.error("Error loading games JSON:", error);
        }
      }

      function toggleTag(tag, btn) {
        if (selectedTags.has(tag)) {
          selectedTags.delete(tag);
          btn.classList.remove("active");
        } else {
          selectedTags.add(tag);
          btn.classList.add("active");
        }
        if (selectedTags.has("GN")) {
          renderGamesGN();
        } else {
          renderGames();
        }
      }

      function renderGames() {
        container.innerHTML = "";
        const filteredGames = selectedTags.size === 0 ? allGames : allGames.filter(game => (game.tags || []).some(t => selectedTags.has(t)));
        filteredGames.forEach(game => {
          const gameBox = document.createElement("div");
          gameBox.className = "game-box";
          gameBox.innerHTML = `
                    
						<img src="images/${game.id}.png" alt="${game.title}" onerror="this.src='images/default.png'">
							<a href="embed.html?id=${game.id}">${game.title}</a>
                `;
          container.appendChild(gameBox);
        });
      }
      async function renderGamesGN() {
        const zonesURL = "https://cdn.jsdelivr.net/gh/gn-math/assets/zones.json";
        const imgBase = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
        try {
          const response = await fetch(zonesURL);
          const zones = await response.json();
          container.innerHTML = "";
          zones.forEach(zone => {
            const img = zone.cover.replace("{COVER_URL}", imgBase);
            const card = document.createElement('div');
            card.className = 'zone-card game-box';
            card.innerHTML = `
                        
							<img src="${img}" alt="${zone.name}">
								<a href="#">${zone.name}</a>
                    `;
            card.onclick = (e) => {
              e.preventDefault();
              window.location.href = `embed_gn.html?id=${zone.id}`;
            };
            container.appendChild(card);
          });
        } catch (error) {
          container.innerHTML = " < p > Error loading external zones. < /p>";
          console.error(error);
        }
      }
      document.addEventListener("DOMContentLoaded", loadGames);
    </script>
  </body>
</html>